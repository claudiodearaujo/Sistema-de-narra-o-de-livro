openapi: 3.0.3
info:
  title: AI API - Sistema de Narração de Livro
  description: |
    API de Inteligência Artificial para geração de áudio (TTS), texto e imagens.

    ## Autenticação
    Todas as rotas (exceto públicas) requerem autenticação via Bearer token JWT.

    ## Sistema de Livras
    As operações de IA consomem Livras (moeda virtual da plataforma).
    Cada operação tem um custo em Livras que pode ser consultado em `/api/ai/costs`.

    ## Providers Disponíveis
    - **TTS**: `elevenlabs` (padrão), `gemini`
    - **Text**: `gemini` (padrão)
    - **Image**: `gemini` (padrão)

    ## Cache de Áudio
    Áudios gerados são automaticamente armazenados em cache baseado em hash do texto + voz + provider.
    Requisições idênticas retornam do cache sem custo em Livras.

  version: 1.0.0
  contact:
    name: Sistema de Narração de Livro

servers:
  - url: /api/ai
    description: AI API Base Path

tags:
  - name: TTS
    description: Text-to-Speech operations (geração de áudio)
  - name: Text
    description: Text processing operations (correção, sugestões, enriquecimento)
  - name: Image
    description: Image generation operations
  - name: Sync
    description: Chapter synchronization with timeline
  - name: Usage
    description: Usage statistics and costs
  - name: Admin
    description: Administrative endpoints (requires ADMIN role)

paths:
  # ========== TTS Endpoints ==========
  /tts/voices:
    get:
      tags: [TTS]
      summary: Lista vozes disponíveis
      description: Retorna todas as vozes disponíveis no provider de TTS.
      security:
        - bearerAuth: []
      parameters:
        - name: provider
          in: query
          description: Provider de TTS (opcional, usa padrão se não especificado)
          schema:
            type: string
            enum: [elevenlabs, gemini]
      responses:
        '200':
          description: Lista de vozes
          content:
            application/json:
              schema:
                type: object
                properties:
                  voices:
                    type: array
                    items:
                      $ref: '#/components/schemas/Voice'
                  count:
                    type: integer
                    example: 25
                  usage:
                    $ref: '#/components/schemas/UsageInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tts/generate:
    post:
      tags: [TTS]
      summary: Gera áudio a partir de texto
      description: |
        Converte texto em áudio usando o provider de TTS configurado.

        **Cache**: Áudios são cacheados automaticamente. Requisições idênticas (mesmo texto + voz + provider) retornam do cache sem custo.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text, voiceId]
              properties:
                text:
                  type: string
                  description: Texto a ser convertido em áudio
                  example: "Olá, este é um teste de narração."
                voiceId:
                  type: string
                  description: ID da voz a ser utilizada
                  example: "21m00Tcm4TlvDq8ikWAM"
                outputFormat:
                  type: string
                  enum: [mp3, wav, ogg, aac]
                  default: mp3
                  description: Formato do áudio de saída
                provider:
                  type: string
                  enum: [elevenlabs, gemini]
                  description: Provider de TTS (opcional)
                useCache:
                  type: boolean
                  default: true
                  description: Se deve usar cache (padrão true)
      responses:
        '200':
          description: Áudio gerado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  audioBase64:
                    type: string
                    description: Áudio em Base64
                  format:
                    type: string
                    example: mp3
                  fromCache:
                    type: boolean
                    description: Se o áudio veio do cache
                  usage:
                    $ref: '#/components/schemas/UsageInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '402':
          $ref: '#/components/responses/InsufficientBalance'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /tts/preview:
    post:
      tags: [TTS]
      summary: Preview de uma voz
      description: Gera um preview curto de áudio para uma voz específica.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [voiceId]
              properties:
                voiceId:
                  type: string
                  description: ID da voz
                  example: "21m00Tcm4TlvDq8ikWAM"
                sampleText:
                  type: string
                  description: Texto de amostra (opcional, usa padrão)
                  example: "Esta é uma amostra de voz."
                provider:
                  type: string
                  enum: [elevenlabs, gemini]
      responses:
        '200':
          description: Preview gerado
          content:
            application/json:
              schema:
                type: object
                properties:
                  audioBase64:
                    type: string
                  format:
                    type: string
                  voiceId:
                    type: string
                  usage:
                    $ref: '#/components/schemas/UsageInfo'
        '402':
          $ref: '#/components/responses/InsufficientBalance'

  /tts/narrate-chapter:
    post:
      tags: [TTS]
      summary: Narra todas as falas de um capítulo
      description: |
        Gera áudio para todas as falas do capítulo sequencialmente.
        Notifica progresso via WebSocket no canal `chapter:{chapterId}`.

        **Eventos WebSocket**:
        - `narration:started` - Início da narração
        - `narration:progress` - Progresso (fala atual)
        - `narration:speech-completed` - Fala concluída
        - `narration:speech-failed` - Erro em uma fala
        - `narration:completed` - Narração finalizada
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [chapterId]
              properties:
                chapterId:
                  type: string
                  format: uuid
                  description: ID do capítulo
                provider:
                  type: string
                  enum: [elevenlabs, gemini]
      responses:
        '200':
          description: Narração concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  speechCount:
                    type: integer
                    description: Total de falas
                  completedCount:
                    type: integer
                    description: Falas completadas com sucesso
                  errors:
                    type: array
                    items:
                      type: string
                    description: Lista de erros ocorridos
                  usage:
                    $ref: '#/components/schemas/UsageInfo'

  # ========== Text Endpoints ==========
  /text/spellcheck:
    post:
      tags: [Text]
      summary: Correção ortográfica
      description: Verifica e corrige erros ortográficos no texto.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text]
              properties:
                text:
                  type: string
                  description: Texto a ser verificado
                  example: "O personagen caminhou pela rua."
                language:
                  type: string
                  default: pt-BR
                  description: Idioma do texto
      responses:
        '200':
          description: Resultado da correção
          content:
            application/json:
              schema:
                type: object
                properties:
                  originalText:
                    type: string
                  correctedText:
                    type: string
                  corrections:
                    type: array
                    items:
                      type: object
                      properties:
                        original:
                          type: string
                        correction:
                          type: string
                        position:
                          type: integer
                  usage:
                    $ref: '#/components/schemas/UsageInfo'

  /text/suggest:
    post:
      tags: [Text]
      summary: Sugestões de melhoria
      description: Sugere melhorias para o texto (estilo, clareza, tom).
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text]
              properties:
                text:
                  type: string
                  description: Texto para análise
                characterId:
                  type: string
                  format: uuid
                  description: ID do personagem (para contexto)
                chapterId:
                  type: string
                  format: uuid
                  description: ID do capítulo (para contexto)
                includeContext:
                  type: boolean
                  default: false
                  description: Incluir contexto do capítulo/personagem
      responses:
        '200':
          description: Sugestões de melhoria
          content:
            application/json:
              schema:
                type: object
                properties:
                  suggestions:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          enum: [style, clarity, tone, grammar]
                        original:
                          type: string
                        suggestion:
                          type: string
                        reason:
                          type: string
                  usage:
                    $ref: '#/components/schemas/UsageInfo'

  /text/enrich:
    post:
      tags: [Text]
      summary: Enriquecimento com dados do personagem
      description: Enriquece o texto com detalhes e características do personagem.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [characterId]
              properties:
                text:
                  type: string
                  description: Texto a enriquecer (opcional)
                characterId:
                  type: string
                  format: uuid
                  description: ID do personagem
      responses:
        '200':
          description: Texto enriquecido
          content:
            application/json:
              schema:
                type: object
                properties:
                  enrichedText:
                    type: string
                  addedDetails:
                    type: array
                    items:
                      type: string
                  usage:
                    $ref: '#/components/schemas/UsageInfo'

  # ========== Image Endpoints ==========
  /image/generate:
    post:
      tags: [Image]
      summary: Gera imagem a partir de prompt
      description: Gera uma imagem usando IA a partir de um prompt textual.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [prompt]
              properties:
                prompt:
                  type: string
                  description: Descrição da imagem desejada
                  example: "Uma floresta encantada ao pôr do sol, estilo fantasy art"
                negativePrompt:
                  type: string
                  description: O que evitar na imagem
                width:
                  type: integer
                  default: 1024
                height:
                  type: integer
                  default: 1024
                style:
                  type: string
                  description: Estilo artístico
      responses:
        '200':
          description: Imagem gerada
          content:
            application/json:
              schema:
                type: object
                properties:
                  imageUrl:
                    type: string
                    description: URL da imagem gerada
                  imageBase64:
                    type: string
                    description: Imagem em Base64
                  usage:
                    $ref: '#/components/schemas/UsageInfo'
        '402':
          $ref: '#/components/responses/InsufficientBalance'

  /image/emotion:
    post:
      tags: [Image]
      summary: Gera imagem emocional
      description: Gera uma imagem que representa a emoção/atmosfera do texto.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text]
              properties:
                text:
                  type: string
                  description: Texto para análise emocional
                characterId:
                  type: string
                  format: uuid
                  description: ID do personagem (para contexto visual)
                styleHint:
                  type: string
                  description: Dica de estilo artístico
      responses:
        '200':
          description: Imagem emocional gerada
          content:
            application/json:
              schema:
                type: object
                properties:
                  imageUrl:
                    type: string
                  emotion:
                    type: string
                    description: Emoção detectada
                  usage:
                    $ref: '#/components/schemas/UsageInfo'

  # ========== Sync Endpoints ==========
  /sync/chapter:
    post:
      tags: [Sync]
      summary: Sincroniza um capítulo
      description: |
        Gera áudios para todas as falas, concatena em um único arquivo e cria timeline.

        Pode ser executado em background (via fila BullMQ) ou síncrono.

        **Timeline**: Cada fala recebe timestamps de início e fim no áudio concatenado.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [chapterId]
              properties:
                chapterId:
                  type: string
                  format: uuid
                provider:
                  type: string
                  enum: [elevenlabs, gemini]
                background:
                  type: boolean
                  default: false
                  description: Executar em background (retorna jobId)
                priority:
                  type: integer
                  description: Prioridade na fila (1-10, maior = mais prioridade)
      responses:
        '200':
          description: Sincronização iniciada ou concluída
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Execução em background
                    properties:
                      message:
                        type: string
                      jobId:
                        type: string
                      queued:
                        type: boolean
                      chapterId:
                        type: string
                  - type: object
                    description: Execução síncrona
                    properties:
                      success:
                        type: boolean
                      narrationId:
                        type: string
                      outputUrl:
                        type: string
                        description: URL do áudio concatenado
                      totalDurationMs:
                        type: integer
                      completedSpeeches:
                        type: integer
                      failedSpeeches:
                        type: integer
                      errors:
                        type: array
                        items:
                          type: string
                      timeline:
                        $ref: '#/components/schemas/ChapterTimeline'

  /sync/chapter/{chapterId}/status:
    get:
      tags: [Sync]
      summary: Status de sincronização do capítulo
      security:
        - bearerAuth: []
      parameters:
        - name: chapterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Status da sincronização
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [pending, processing, completed, failed]
                  progress:
                    type: number
                    description: Percentual de progresso (0-100)
                  totalSpeeches:
                    type: integer
                  completedSpeeches:
                    type: integer
                  failedSpeeches:
                    type: integer
                  outputUrl:
                    type: string
                  errorMessage:
                    type: string
        '404':
          description: Nenhuma sincronização encontrada

  /sync/chapter/{chapterId}/timeline:
    get:
      tags: [Sync]
      summary: Timeline do capítulo
      description: Retorna a timeline completa com timestamps de cada fala.
      security:
        - bearerAuth: []
      parameters:
        - name: chapterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Timeline do capítulo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChapterTimeline'
        '404':
          description: Timeline não encontrada

  /sync/speech/{speechId}/regenerate:
    post:
      tags: [Sync]
      summary: Regenera áudio de uma fala
      description: Regenera o áudio de uma fala específica. O capítulo precisa ser re-sincronizado para atualizar a timeline.
      security:
        - bearerAuth: []
      parameters:
        - name: speechId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                provider:
                  type: string
                  enum: [elevenlabs, gemini]
      responses:
        '200':
          description: Áudio regenerado
          content:
            application/json:
              schema:
                type: object
                properties:
                  speechId:
                    type: string
                  audioUrl:
                    type: string
                  durationMs:
                    type: integer
                  message:
                    type: string

  /sync/job/{jobId}:
    get:
      tags: [Sync]
      summary: Status de um job na fila
      security:
        - bearerAuth: []
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status do job
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  state:
                    type: string
                    enum: [waiting, active, completed, failed, delayed]
                  progress:
                    type: number
                  data:
                    type: object
                  result:
                    type: object
                  failedReason:
                    type: string
        '404':
          description: Job não encontrado
    delete:
      tags: [Sync]
      summary: Cancela um job pendente
      security:
        - bearerAuth: []
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job cancelado
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  jobId:
                    type: string
        '400':
          description: Não foi possível cancelar

  # ========== Usage Endpoints ==========
  /usage:
    get:
      tags: [Usage]
      summary: Resumo de uso do usuário
      description: Retorna estatísticas de uso de IA do usuário autenticado.
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [day, week, month]
            default: month
      responses:
        '200':
          description: Resumo de uso
          content:
            application/json:
              schema:
                type: object
                properties:
                  period:
                    type: string
                  totalOperations:
                    type: integer
                  totalInputChars:
                    type: integer
                  totalOutputBytes:
                    type: integer
                  totalEstimatedCost:
                    type: number
                    description: Custo estimado em USD
                  totalLivrasSpent:
                    type: integer
                  byOperation:
                    type: object
                    additionalProperties:
                      type: integer
                  byProvider:
                    type: object
                    additionalProperties:
                      type: integer

  /costs:
    get:
      tags: [Usage]
      summary: Lista custos das operações
      description: Retorna o custo em Livras e estimativa em USD de cada operação.
      responses:
        '200':
          description: Custos das operações
          content:
            application/json:
              schema:
                type: object
                properties:
                  costs:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        livras:
                          type: integer
                        estimatedUsd:
                          type: number
                example:
                  costs:
                    TTS_GENERATE:
                      livras: 5
                      estimatedUsd: 0.01
                    IMAGE_GENERATE:
                      livras: 10
                      estimatedUsd: 0.04

  /providers:
    get:
      tags: [Usage]
      summary: Providers disponíveis
      description: Lista os providers de IA disponíveis e configurados.
      responses:
        '200':
          description: Informações dos providers
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    type: object
                    properties:
                      current:
                        type: string
                      available:
                        type: array
                        items:
                          type: string
                  image:
                    type: object
                    properties:
                      current:
                        type: string
                      available:
                        type: array
                        items:
                          type: string
                  tts:
                    type: object
                    properties:
                      current:
                        type: string
                      available:
                        type: array
                        items:
                          type: string

  # ========== Admin Endpoints ==========
  /admin/stats:
    get:
      tags: [Admin]
      summary: Estatísticas da plataforma
      description: Retorna estatísticas gerais de uso de IA da plataforma (Admin only).
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [day, week, month]
            default: month
      responses:
        '200':
          description: Estatísticas da plataforma
          content:
            application/json:
              schema:
                type: object
                properties:
                  period:
                    type: string
                  totalOperations:
                    type: integer
                  totalUsers:
                    type: integer
                  totalInputChars:
                    type: integer
                  totalOutputBytes:
                    type: integer
                  totalEstimatedCostUsd:
                    type: number
                  totalLivrasSpent:
                    type: integer
                  successRate:
                    type: number
                    description: Taxa de sucesso (0-100)
                  byOperation:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        count:
                          type: integer
                        livras:
                          type: integer
                        usd:
                          type: number
                  byProvider:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        count:
                          type: integer
                        livras:
                          type: integer
                        usd:
                          type: number
                  topUsers:
                    type: array
                    items:
                      type: object
                      properties:
                        userId:
                          type: string
                        operations:
                          type: integer
                        livrasSpent:
                          type: integer
        '403':
          $ref: '#/components/responses/Forbidden'

  /admin/history:
    get:
      tags: [Admin]
      summary: Histórico de uso por dia
      description: Retorna histórico diário de uso (Admin only).
      security:
        - bearerAuth: []
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Histórico de uso
          content:
            application/json:
              schema:
                type: object
                properties:
                  days:
                    type: integer
                  history:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date
                        operations:
                          type: integer
                        livrasSpent:
                          type: integer
                        estimatedUsd:
                          type: number

  /admin/costs:
    get:
      tags: [Admin]
      summary: Lista configurações de custo
      description: Lista todas as configurações de custo em Livras (Admin only).
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Configurações de custo
          content:
            application/json:
              schema:
                type: object
                properties:
                  costs:
                    type: array
                    items:
                      type: object
                      properties:
                        operation:
                          type: string
                        configKey:
                          type: string
                        defaultValue:
                          type: integer
                        currentValue:
                          type: integer
                        estimatedUsd:
                          type: number

  /admin/costs/{operation}:
    put:
      tags: [Admin]
      summary: Atualiza custo de operação
      description: Atualiza o custo em Livras de uma operação (Admin only).
      security:
        - bearerAuth: []
      parameters:
        - name: operation
          in: path
          required: true
          schema:
            type: string
            enum:
              - TTS_GENERATE
              - TTS_PREVIEW
              - TEXT_GENERATE
              - TEXT_SPELLCHECK
              - TEXT_SUGGEST
              - TEXT_ENRICH
              - IMAGE_GENERATE
              - IMAGE_EMOTION
              - NARRATION_CHAPTER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [livrasCost]
              properties:
                livrasCost:
                  type: integer
                  minimum: 0
                  description: Novo custo em Livras
                  example: 5
      responses:
        '200':
          description: Custo atualizado
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  operation:
                    type: string
                  oldCost:
                    type: integer
                  newCost:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'

  /admin/cache/stats:
    get:
      tags: [Admin]
      summary: Estatísticas do cache de áudio
      description: Retorna estatísticas do cache de áudio (Admin only).
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas do cache
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalEntries:
                    type: integer
                  totalSizeBytes:
                    type: integer
                  totalSizeMB:
                    type: string
                  totalHits:
                    type: integer
                  oldestEntry:
                    type: string
                    format: date-time
                    nullable: true
                  newestEntry:
                    type: string
                    format: date-time
                    nullable: true
                  byProvider:
                    type: object
                    additionalProperties:
                      type: integer

  /admin/cache/clean:
    post:
      tags: [Admin]
      summary: Limpa o cache de áudio
      description: Remove entradas do cache de áudio (Admin only).
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [type]
              properties:
                type:
                  type: string
                  enum: [expired, unused, all]
                  description: |
                    Tipo de limpeza:
                    - `expired`: Remove entradas com data de expiração passada
                    - `unused`: Remove entradas não acessadas há X dias
                    - `all`: Remove todas as entradas
                daysUnused:
                  type: integer
                  default: 30
                  description: Dias sem acesso (apenas para type=unused)
      responses:
        '200':
          description: Cache limpo
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  type:
                    type: string
                  removedCount:
                    type: integer

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtido no login

  schemas:
    Voice:
      type: object
      properties:
        voiceId:
          type: string
          description: ID único da voz
        name:
          type: string
          description: Nome da voz
        gender:
          type: string
          enum: [male, female, neutral]
        language:
          type: string
          description: Código do idioma
        description:
          type: string
          description: Descrição da voz
        previewUrl:
          type: string
          description: URL para preview da voz
        labels:
          type: array
          items:
            type: string
          description: Tags/categorias da voz

    UsageInfo:
      type: object
      properties:
        operation:
          type: string
          description: Nome da operação
        provider:
          type: string
          description: Provider utilizado
        livrasCost:
          type: integer
          description: Custo cobrado em Livras
        durationMs:
          type: integer
          description: Duração da operação em ms

    ChapterTimeline:
      type: object
      properties:
        chapterId:
          type: string
          format: uuid
        chapterTitle:
          type: string
        totalDurationMs:
          type: integer
          description: Duração total do capítulo em ms
        speeches:
          type: array
          items:
            type: object
            properties:
              speechId:
                type: string
                format: uuid
              orderIndex:
                type: integer
              characterName:
                type: string
              text:
                type: string
              audioDurationMs:
                type: integer
              startTimeMs:
                type: integer
                description: Início no áudio concatenado
              endTimeMs:
                type: integer
                description: Fim no áudio concatenado
              audioUrl:
                type: string
                description: URL do áudio individual

    Error:
      type: object
      properties:
        error:
          type: string
          description: Mensagem de erro
        code:
          type: string
          description: Código do erro (opcional)

  responses:
    BadRequest:
      description: Requisição inválida
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Texto é obrigatório"

    Unauthorized:
      description: Não autenticado
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Token de autenticação inválido ou expirado"

    Forbidden:
      description: Acesso negado
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              code:
                type: string
              required:
                type: array
                items:
                  type: string
              current:
                type: string
          example:
            error: "Acesso negado. Você não tem permissão para acessar este recurso."
            code: "INSUFFICIENT_ROLE"
            required: ["ADMIN"]
            current: "USER"

    InsufficientBalance:
      description: Saldo de Livras insuficiente
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Saldo insuficiente de Livras. Necessário: 5"
